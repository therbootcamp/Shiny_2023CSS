<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Dashboards mit Shiny      The R Bootcamp @ CSS  " />


<title>Erste App</title>

<script src="ErsteApp_practical_files/header-attrs-2.20/header-attrs.js"></script>
<script src="ErsteApp_practical_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="ErsteApp_practical_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="ErsteApp_practical_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="ErsteApp_practical_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="ErsteApp_practical_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="ErsteApp_practical_files/navigation-1.1/tabsets.js"></script>
<link href="ErsteApp_practical_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="ErsteApp_practical_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="practical.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="header">



<h1 class="title toc-ignore">Erste App</h1>
<h4 class="author"><font style='font-style:normal'>Dashboards mit
Shiny</font><br>
<a href='https://therbootcamp.github.io/Shiny_2023CSS/'><i class='fas fa-clock' style='font-size:.9em;' ></i></a>
<a href='https://therbootcamp.github.io'><i class='fas fa-home' style='font-size:.9em;'></i></a>
<a href='mailto:therbootcamp@gmail.com'><i class='fas fa-envelope' style='font-size: .9em;'></i></a>
<a href='https://www.linkedin.com/company/basel-r-bootcamp/'><i class='fab fa-linkedin' style='font-size: .9em;'></i></a>
<a href='https://therbootcamp.github.io'><font style='font-style:normal'>The
R Bootcamp @ CSS</font></a><br>
<img src='https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/by-sa.png' style='height:15px;width:80px'/></h4>

</div>


<p align="center" width="100%">
<img src="image/xray.jpg" alt="Trulli" style="width:100%"> <br>
<font style="font-size:10px">from
<a href="https://unsplash.com/photos/ouyjDk-KdfY">unsplash.com</a></font>
</p>
<div id="section" class="section level1 tabset">
<h1 class="tabset"></h1>
<div id="information" class="section level2">
<h2>Information</h2>
<p>Dieses Practical besteht aus zwei Teilen.</p>
<ol style="list-style-type: decimal">
<li>Aufgaben: Mit mehreren kleinen Apps wiederholst du zentrale Inhalte
der Präsentation.<br />
</li>
<li>App: Über die Sessions hinweg entwickelst Du die
<a href="https://dirkwulff.shinyapps.io/TheRBootcamp/">InjuryViewer</a>
App</li>
</ol>
<p>Wie viel Zeit du in <em>Aufgaben</em> oder <em>App</em> verbringst
ist dir überlassen. Wir empfehlen aber allen mit wenig Erfahrung mit
Shiny erst einmal in Aufgaben zu schauen. Für die App stellen wir in
einem eigenen Tab die Lösungen zur Verfügungen, so dass du in neue
Themen einsteigen kannst ohne notwendigerweise alle Schritte der
Appentwicklung abgeschlossen zu haben.</p>
<p>Für jede App in Aufgaben erstelle bitte ein <strong>neues
Skript</strong> und speichere es unter dem Namen der
Abschnittsberschrift. Denk dran bei jedem neuen Skript
<code>library(shiny)</code> an den Anfang zu setzen. Falls weitere
Pakete nötig sind, werden sie in der jeweileigen Abschnitten
erwähnt.</p>
<p>Gerade am Anfang stellen wir Code-Templates zur verfügung in denen du
allein die <code>XX</code> durch den richtigen Code bzw. die richtigen
Objekte erstezen musst.</p>
</div>
<div id="aufgaben" class="section level2">
<h2>Aufgaben</h2>
<div id="a---hello-world" class="section level3">
<h3>A - Hello world</h3>
<ol style="list-style-type: decimal">
<li>Deine erste Shiny App! Definiere eine UI, die in einer
<code>fluidPage()</code> einen Text anzeigt. Das Textfeld soll die ID
<code>"text"</code> haben.</li>
</ol>
<pre class="r"><code>ui &lt;- XX(
  textOutput(XX)
  )</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Definiere eine <code>server</code> Funnktion, die den Text
<code>Hello World!</code> anzeigt. Beachte, dass der Name des Elements
in der <code>output</code> Liste (<code>output$Element</code>) der ID
des Outputs im UI entsprechen muss.</li>
</ol>
<pre class="r"><code>server &lt;- function(input, output, session) {
  output$XX = renderText(XX)
  }</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><p>Schreibe <code>shinyApp(ui, server)</code> und Starte deine App
auf einem der verschiedenen Wege. Z.B. über Cmd+Shift+Enter (Mac) bzw.
Ctrl+Shift+Enter (Windows). Start die App und zeigt sie
<code>Hallo Welt!</code> an?</p></li>
<li><p>Probiere aus die App entweder im Viewer unten rechts (Run in
Viewer Pane) oder direkt im Browser (Run External) zu starten. Benutze
hierfür das Dropdown-Menu neben <code>Run App</code> in der
Menuzeile.</p></li>
</ol>
</div>
<div id="b---wie-heisst-du" class="section level3">
<h3>B - Wie heisst Du?</h3>
<ol style="list-style-type: decimal">
<li>App Nummer zwei und dein erster interaktiver Input. Kreiere eine UI,
die in einer <code>fluidPage()</code> einen <code>textInput</code> mit
ID <code>"name"</code> und Label <code>"Wie heisst Du?"</code> enthält.
Zudem ergänze einen <code>textOutput</code> mit ID
<code>"gruss"</code>.</li>
</ol>
<pre class="r"><code>ui &lt;- fluidPage(
  XX(XX, XX),
  XX(XX)
  )</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Kreiere eine <code>server</code> Funktion mit einem
<code>renderText()</code>, das einem dem Output mit richtigem Namen
zugewiesen wir, sodass der Text anstelle des <code>textOutput</code> in
der UI erscheint. Um den Inhalt von <code>renderText()</code> kümmern
wir uns gleich.</li>
</ol>
<pre class="r"><code>server &lt;- function(input, output, session) {
  output$XX &lt;- XX()
  }</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Innerhalb des <code>renderText</code> definiere den Textoutput
mithilfe von <code>paste</code>, einer Funktion, die ihre Inhalte zu
einem einzelnen String zussammenfügt. Anstelle des <code>XX$XX</code>
definiere den Input des <code>textInput</code>s, sodass die fertige App
den Nutzer mit dem eingegebenen Namen begrüsst.</li>
</ol>
<pre class="r"><code>server &lt;- function(input, output, session) {
  output$XX &lt;- XX(paste(&quot;Hallo&quot;, XX$XX, &quot;!&quot;))
  }</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Lasse die App mit <code>shinyApp(ui, server)</code> laufen. Begrüsst
sie dich beim Namen?</li>
</ol>
</div>
<div id="c---multiplier" class="section level3">
<h3>C - Multiplier</h3>
<ol style="list-style-type: decimal">
<li>Baue nun mittels zweier Sliders die Multiplier App, die zwei
Sliderwerte miteinander multipliziert und den Output als text ausgibt.
Definiere zunächst eine UI mit zwei <code>sliderInput</code> - ID
<code>"x"</code> und <code>y</code> und Label <code>"Mit x ="</code> und
<code>"Und y ="</code> - und einem <code>textOutput</code> mit ID
<code>"produkt"</code>.</li>
</ol>
<pre class="r"><code>ui &lt;- fluidPage(
  XX(XX, XX),
  XX(XX, XX),
  XX(XX)
  )</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Passe nun auch noch die anderen Slider-Argumente <code>min</code>,
<code>max</code>, und <code>value</code> an. Diese Argumente
spezifizieren den Minimalwert, den Maximalwert, und den Defaultwert.
Suche dir einfach Werte aus.</li>
</ol>
<pre class="r"><code>ui &lt;- fluidPage(
  XX(XX, XX, XX, XX, XX),
  XX(XX, XX, XX, XX, XX),
  XX(XX)
  )</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Definiere nun einen <code>server</code> analog zum server der
letzten App. Dh. definiere einen <code>renderText</code>, das dem
richtigen Outputelement zugewiesen wird und mittels <code>paste</code>
das Produkt der beiden Inputs zurück gibt.</li>
</ol>
<pre class="r"><code>server &lt;- function(input, output, session) {
  output$XX &lt;- XX(XX(&quot;Dann ist das Produkt gleich&quot;, XX$XX * XX$XX, &quot;!&quot;))
  }</code></pre>
</div>
<div id="d---explore" class="section level3">
<h3>D - Explore</h3>
<ol style="list-style-type: decimal">
<li>Baue andere Apps mit anderen Inputs z.B. <code>radioButtons</code>,
<code>checkboxGroupInput</code>, oder <code>dateInput</code>.</li>
</ol>
</div>
</div>
<div id="app" class="section level2">
<h2>App</h2>
<ol style="list-style-type: decimal">
<li>Beginnen wir mit der InjuryViewer App. Zuallererst lade den
Datensatz mit dem folgenden Code. Die Daten enthalten Informationen zu
Unfällen und Verletzungen, die wir mit unserer App explorierbar machen
wollen. Mehr über den Datensatz kannst Du unter dem Datensatz tab
erfahren.</li>
</ol>
<pre class="r"><code>verletzungen = readRDS(&quot;data/verletzungen.RDS&quot;)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Baue nun eine UI mit zwei Inputs, einem <code>selectInput</code> mit
ID <code>"körperteil"</code> zur Auswahl der von der Verletzung
betroffenen Körperteile und einen <code>sliderInput</code> ID
<code>"alter"</code> zur Auswahl einer Altersspanne. Als drittes ergänze
einen <code>plotOutput</code> mit ID <code>linien_plot</code>, der den
ersten Plot der App zeigen wird. Entwickle erst einmal die Struktur - um
die weiteren Inhalte der Inhalte der Inputs kümmern wir uns gleich.
Keine Sorge, wenn noch Fehlermeldungen aufgrund fehlender Argumente
entstehen.</li>
</ol>
<pre class="r"><code>ui &lt;- fluidPage(
  XX(XX),
  XX(XX),
  XX(XX),
  )</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Der <code>selectInput</code> soll ermöglichen, dass der Nutzer ein
oder mehrere Körperteile auswählt. Damit dies funktioniert, stelle der
<code>selectInput</code> Funktion per <code>choices</code> Argument
einen Vektor mit möglichen Körperteilen bereit, den du mit
<code>unique(verletzungen$körperteil)</code> aus dem Datensatz ziehen
kannst. Zudem setze <code>multiple</code> auf <code>TRUE</code>, damit
mehrere Auswahlen möglich sind. Natürlich solltest du zudem noch ein
Label vergeben - setze es auf <code>"Körperteil"</code>.</li>
</ol>
<pre class="r"><code>ui &lt;- fluidPage(
  XX(XX, label = XX, choices = XX, multiple = XX),
  XX(XX),
  XX(XX),
  )</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Der <code>sliderInput</code> soll die Eingabe einer Altersrange
zwischen 0 (<code>min</code>) und 110 (<code>max</code>) erlauben.
Hierzu weise dem Argument <code>values</code> einene Vektor mit zwei
Werten (z.B. <code>c(0,110)</code>) zu, die den Default Minimal- und
Maximalwert bestimmen. R schliesst aus der Anwesenheit von zwei Werten,
dass der Slider eine Spanne definieren soll. Wähle zudem als Label
<code>"Alter"</code>.</li>
</ol>
<pre class="r"><code>ui &lt;- fluidPage(
  XX(XX, label = XX, choices = XX, multiple = XX),
  XX(XX, label = XX, min = XX, max = XX, values = XX),
  XX(XX),
  )</code></pre>
<ol start="5" style="list-style-type: decimal">
<li>Definiere nun den Server. Benutze <code>renderPlot</code>, um einen
Plot, zu dem wir gleich noch kommen, dem richtigen Output zuzuweisen.
Erinnere, der Name des Output Elements muss identisch mit der ID des
Outputs in der UI sein.</li>
</ol>
<pre class="r"><code>server &lt;- function(input, output, session) {
  
  output$XX = renderPlot({
  
    })
  
}</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Innerhalb der geschweiften Klammern setze nun diesen Plot, der die
Häufigkeit von Verletzungen separat für männliche und weibliche
Patienten anzeigt. Damit der Plot funkioniert musst du vorher noch das
<code>tidyverse</code> Paket (bzw. <code>ggplot2</code> und
<code>dplyr</code>) laden. Setze hier <code>library(tidyverse)</code>
(bzw. <code>library(ggplot2)</code> und <code>library(dplyr)</code>)
unter <code>library(shiny)</code> in deinem Skript. Beachte wie
innerhalb des <code>filter</code> die Inputs verwendet werden um die
gewünschten Fälle aus dem Datensatz auszuwählen.</li>
</ol>
<pre class="r"><code>  verletzungen %&gt;% 
    filter(körperteil %in% input$körperteil, 
           alter &gt;= input$alter[1],
           alter &lt;= input$alter[2]) %&gt;% 
    count(alter, geschlecht, wt = anzahl) %&gt;%
    ggplot(aes(x = alter, y = n, col = geschlecht)) +
    geom_line(linewidth = 1.5) +
    theme_minimal() +
    theme(
      axis.text = element_text(size = 12),
      axis.title = element_text(size = 16),
      legend.text = element_text(size = 12),
      legend.title = element_text(size = 16),
      plot.margin = margin(.5, .5, 1, 1, unit = &quot;cm&quot;),
      legend.position = &quot;top&quot;
    ) +
    scale_color_viridis_d(name = &quot;Geschlecht&quot;,
                          option = &quot;G&quot;,
                          end = .8) +
    labs(x = &quot;Alter&quot;,
         y = &quot;Geschätzte Anzahl Verletzungen&quot;)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Schreibe nun <code>shinyApp(ui, server)</code> und lasse die App
laufen. Zu Beginn sollte kein Plot zu sehen sein (bzw. nur die
Achsenbeschriftungen). Sobald du allerdings Körperteile auswählst sollte
ein Plot erscheinen. Funktionert es? Probiere aus was passiert wenn du
die Altersspanne änderst.</li>
</ol>
</div>
<div id="lösung" class="section level2">
<h2>Lösung</h2>
<pre class="r"><code>library(shiny)
library(tidyverse)

verletzungen = readRDS(&quot;daten/verletzungen.RDS&quot;)

ui &lt;- fluidPage(
  
  selectInput(&quot;körperteil&quot;, &quot;Körperteil&quot;, 
              choices = unique(verletzungen$körperteil), 
              multiple = TRUE),
  sliderInput(&quot;alter&quot;, &quot;Alter&quot;, min = 0, max = 110, value = c(0, 110)),
  plotOutput(&quot;linien_plot&quot;)
  
  )

server &lt;- function(input, output, session) {

output$linien_plot = renderPlot({
  verletzungen %&gt;% 
    filter(körperteil %in% input$körperteil, 
           alter &gt;= input$alter[1],
           alter &lt;= input$alter[2]) %&gt;% 
    count(alter, geschlecht, wt = anzahl) %&gt;%
    ggplot(aes(x = alter, y = n, col = geschlecht)) +
    geom_line(linewidth = 1.5) +
    theme_minimal() +
    theme(
      axis.text = element_text(size = 12),
      axis.title = element_text(size = 16),
      legend.text = element_text(size = 12),
      legend.title = element_text(size = 16),
      plot.margin = margin(.5, .5, 1, 1, unit = &quot;cm&quot;),
      legend.position = &quot;top&quot;
    ) +
    scale_color_viridis_d(name = &quot;Geschlecht&quot;,
                          option = &quot;G&quot;,
                          end = .8) +
    labs(x = &quot;Alter&quot;,
         y = &quot;Geschätzte Anzahl Verletzungen&quot;)
  })
  
  
}

shinyApp(ui, server)</code></pre>
</div>
<div id="datensatz" class="section level2">
<h2>Datensatz</h2>
<p>Der Datensatz stammt von dem National Electronic Injury Surveillance
System (NEISS) in den USA, das seit vielen Jahren Unfälle aus einem
repräsentativen Stichprobe von Krankenhäusern sammelt. Der Datensatz
wurde ins Deutsche übersetzt und angepasst.<br />
Es liegen zwei Ausschnitte des Datensatzes vor.
<code>verletzungen.RDS</code> beinhaltet alle 251’545 Fälle des Jahres
2017, <code>verletzungen_jahresende.RDS</code> dagegen nur die 4’181
Fälle zwischen Heiligabend und Silvester.</p>
<p>Die beiden Datensätze beinhalten die folgenden Variablen:</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th align="left">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>datum</td>
<td align="left">Datum des Unfalls / der Verletzung</td>
</tr>
<tr class="even">
<td>alter</td>
<td align="left">Alter der Person</td>
</tr>
<tr class="odd">
<td>geschlecht</td>
<td align="left">Geschlecht der Person</td>
</tr>
<tr class="even">
<td>körperteil</td>
<td align="left">Körperteil, das verletzt wurde</td>
</tr>
<tr class="odd">
<td>diagnose</td>
<td align="left">Diagnose der Verletzung</td>
</tr>
<tr class="even">
<td>unfallort</td>
<td align="left">Unfallort der Verletzung</td>
</tr>
<tr class="odd">
<td>gegenstand</td>
<td align="left">Gegenstand, der die Verletzung herbeigeführt hat</td>
</tr>
<tr class="even">
<td>anzahl</td>
<td align="left">Anzahl an Verletzungen</td>
</tr>
</tbody>
</table>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
