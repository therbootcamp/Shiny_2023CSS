<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Dashboards mit Shiny      The R Bootcamp @ CSS  " />


<title>Daten IO</title>

<script src="DatenIO_practical_files/header-attrs-2.20/header-attrs.js"></script>
<script src="DatenIO_practical_files/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="DatenIO_practical_files/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="DatenIO_practical_files/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="DatenIO_practical_files/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="DatenIO_practical_files/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="DatenIO_practical_files/navigation-1.1/tabsets.js"></script>
<link href="DatenIO_practical_files/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="DatenIO_practical_files/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="practical.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>



<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div id="header">



<h1 class="title toc-ignore">Daten IO</h1>
<h4 class="author"><font style='font-style:normal'>Dashboards mit
Shiny</font><br>
<a href='https://therbootcamp.github.io/Shiny_2023CSS/'><i class='fas fa-clock' style='font-size:.9em;' ></i></a>
<a href='https://therbootcamp.github.io'><i class='fas fa-home' style='font-size:.9em;'></i></a>
<a href='mailto:therbootcamp@gmail.com'><i class='fas fa-envelope' style='font-size: .9em;'></i></a>
<a href='https://www.linkedin.com/company/basel-r-bootcamp/'><i class='fab fa-linkedin' style='font-size: .9em;'></i></a>
<a href='https://therbootcamp.github.io'><font style='font-style:normal'>The
R Bootcamp @ CSS</font></a><br>
<img src='https://raw.githubusercontent.com/therbootcamp/therbootcamp.github.io/master/_sessions/_image/by-sa.png' style='height:15px;width:80px'/></h4>

</div>


<p align="center" width="100%">
<img src="image/signal.png" alt="Trulli" style="width:100%"> <br>
<font style="font-size:10px">from
<a href="https://unsplash.com/photos/ouyjDk-KdfY">unsplash.com</a></font>
</p>
<div id="section" class="section level1 tabset">
<h1 class="tabset"></h1>
<div id="information" class="section level2">
<h2>Information</h2>
<p>Dieses Practical besteht aus zwei Teilen.</p>
<ol style="list-style-type: decimal">
<li>Aufgaben: Mit mehreren kleinen Apps wiederholst du zentrale Inhalte
der Präsentation.<br />
</li>
<li>App: Über die Sessions hinweg entwickelst Du die
<a href="https://dirkwulff.shinyapps.io/TheRBootcamp/">InjuryViewer</a>
App</li>
</ol>
<p>Wie viel Zeit du in <em>Aufgaben</em> oder <em>App</em> verbringst
ist dir überlassen. Wir empfehlen aber allen mit wenig Erfahrung mit
Shiny erst einmal in Aufgaben zu schauen. Für die App stellen wir in
einem eigenen Tab die Lösungen zur Verfügungen, so dass du in neue
Themen einsteigen kannst ohne notwendigerweise alle Schritte der
Appentwicklung abgeschlossen zu haben.</p>
<p>Für jede App in Aufgaben erstelle bitte ein <strong>neues
Skript</strong> und speichere es unter dem Namen der
Abschnittsberschrift. Denk dran bei jedem neuen Skript
<code>library(shiny)</code> an den Anfang zu setzen. Falls weitere
Pakete nötig sind, werden sie in der jeweileigen Abschnitten
erwähnt.</p>
<p>Gerade am Anfang stellen wir Code-Templates zur verfügung in denen du
allein die <code>XX</code> durch den richtigen Code bzw. die richtigen
Objekte erstezen musst.</p>
</div>
<div id="aufgaben" class="section level2">
<h2>Aufgaben</h2>
<div id="a---dataviewer" class="section level3">
<h3>A - DataViewer</h3>
<ol style="list-style-type: decimal">
<li>Wir bauen eine App, die Daten einliest und als Tabelle anzeigt.
Beginne indem du eine typische <code>sidebarLayout</code> Struktur mit
<code>sidebarPanel</code> und <code>mainPanel</code> für die UI
baust.</li>
</ol>
<pre class="r"><code>ui &lt;- fluidPage{
  XX(
    XX(),
    XX()
  )
}</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Jetzt setze in das <code>sidebarPanel</code> einen
<code>fileInput</code>, der uns erlauben wird Daten einzulesen. Als ID
wähle <code>daten</code> und setze die Argumente <code>label</code>,
<code>buttonlabel</code> und <code>placeholder</code> auf
<code>"Daten hochladen"</code>, <code>"Suche..."</code> und
<code>"Wähle eine Datei"</code>.</li>
</ol>
<pre class="r"><code>ui &lt;- fluidPage(
  titlePanel(&quot;DataViewer&quot;),
  XX(
    XX(
      XX(XX, 
         XX = XX, 
         XX = XX,
         XX = XX)
    ),
    XX()
  )
)</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Ergänze zudem im <code>mainPanel</code> einen
<code>dataTableOutput</code> mit ID <code>daten_table</code>, damit wir
später Daten zu sehen bekommen.</li>
</ol>
<pre class="r"><code>ui &lt;- fluidPage(
  titlePanel(&quot;DataViewer&quot;),
  XX(
    XX(
      XX(XX, 
         XX = XX, 
         XX = XX,
         XX = XX)
    ),
    XX(
      XX(XX)
    )
  )
)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li><p>Teste die UI einmal mit
<code>shinyApp(ui, server = function(input, output, sesssion){})</code>.
Du solltest den Titel und den Donwload sehen, aber noch keine Tabelle,
weil natürlich noch keine Daten geladen wurden.</p></li>
<li><p>Nun zum <code>server</code>. Hier arbeiten wir (wiedermal) mit
einem <code>reactiveVal</code> für die Daten (genannt
<code>daten</code>) und einem <code>observeEvent</code>, der Code
enthält mit dem der <code>reactiveVal</code> überschrieben, sobald der
<code>fileInput</code> in der UI bedient wurde. Baue diese
Grundstruktur.</p></li>
</ol>
<pre class="r"><code>server = function(input, output, sesssion){
  
  XX &lt;- reactiveVal()  
  
  XX(input$XX, {
    
  })
}</code></pre>
<ol start="6" style="list-style-type: decimal">
<li>Nun zun dem Code in <code>observeEvent</code>. Da wir sowohl
<code>.csv</code> als auch <code>.RDS</code> Daten lesen wollen, gilt es
erst einmal die Dateiendung einer einzulesenden Datei zu testen. Tue
dies mit <code>file_ext()</code> aus dem Paket <code>tools</code> (laden
nicht vergessen) und kreiere eine Objekt names <code>endung</code>.
Stelle als Input für <code>file_ext()</code> den eingegebenen Dateipfad
aus <code>fileInput</code> (<code>input$daten$datapath</code>)
bereit.</li>
</ol>
<pre class="r"><code>server = function(input, output, sesssion){
  
  XX &lt;- reactiveVal()  
  
  XX(input$XX, {
    
    XX &lt;- XX(XX)
    
  })
}</code></pre>
<ol start="7" style="list-style-type: decimal">
<li>Nun baue ein <code>if</code>-<code>else</code>, dass die Datei in
<code>input$daten$datapath</code> mit <code>read_csv</code>
(<code>tidyverse</code> laden nicht vergessen), wenn die
<code>endung</code> gleich <code>csv</code>, und die Daten mit
<code>readRDS</code> einliest, wenn die <code>endung</code> gleich
<code>RDS</code> ist. Überschreibe dabei direkt den
<code>reactiveVal</code></li>
</ol>
<pre class="r"><code>server = function(input, output, sesssion){
  
  XX &lt;- reactiveVal()  
  
  XX(input$XX, {
    
    XX &lt;- XX(XX)
    
    if(XX == &quot;csv&quot;){
      XX(XX(XX))
    } else if(XX == &quot;RDS&quot;) {
      XX(XX(XX))
    }
  })
  
  
}</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Zuletzt ergänze noch <code>renderDataTable()</code> ausserhalb des
<code>observeEvent</code>, sodass die eingelesenen Daten auch an die
<code>ui</code> weitergegeben werden. Damit nur 10 Zeilen dargestellt
werde, definiere dabei
<code>options = list(pageLength = 10)</code>.</li>
</ol>
<pre class="r"><code>server = function(input, output, sesssion){
  
  XX &lt;- reactiveVal()  
  
  XX(input$XX, {
    
    XX &lt;- XX(XX)
    
    if(XX == &quot;csv&quot;){
      XX(XX(XX))
    } else if(XX == &quot;RDS&quot;) {
      XX(XX(XX))
    }
  })
  
  output$XX &lt;- XX(XX, XX)
}</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Die erste Iteration der App ist fertig. Teste sie. Erscheinen die
Daten in einer Tabelle, nachdem du eine Datei eingelesen hast?</li>
</ol>
</div>
<div id="b---dataviewer-2.0" class="section level3">
<h3>B - DataViewer 2.0</h3>
<ol style="list-style-type: decimal">
<li>Die zweite Iteration des DataViewers soll erlauben, dass du über ein
<code>textAreaInput</code> Code bereitstellst, der dann auf die
eingelesenen Daten angewendet wird. Kreiere dafür zuerst den
<code>textAreaInput</code>unterhalb des <code>fileInput</code> in der
UI. Setze die ID auf <code>"code"</code>. Zudem kreiere darunter einen
<code>acionButton</code> mit ID <code>code_run</code>, den wir als
Auslöser für den Code verwenden werden. Gibt den beiden Inputs passende
Labels.</li>
</ol>
<pre class="r"><code>ui &lt;- fluidPage(
  titlePanel(&quot;DataViewer&quot;),
  XX(
    XX(
      XX(XX, 
         XX = XX, 
         XX = XX,
         XX = XX),
      XX(XX),
      XX(XX)
    ),
    XX(
      XX(XX)
    )
  )
)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Teste die UI mit
<code>shinyApp(ui, server = function(input, output, sesssion){})</code>.
Sieht alles in Ordnung aus?</p></li>
<li><p>Definiere nun im <code>server</code> einen weiteren
<code>observeEvent</code> in Abhängigkeit von
<code>input$code_run</code>, sodass der Code innerhalb von
<code>observeEvent</code> nur ausgeführt, wenn
<code>input$code_run</code> betätigt wird. Innerhalb des
<code>observeEvent</code> platziere dann
<code>daten(eval(parse(text = input$code)))</code>. Dieser Code evaliert
den Input von <code>input$code</code> und überschreibt damit den
aktuellen Wert des <code>daten()</code>
<code>reactiveValue</code>s.</p></li>
</ol>
<pre class="r"><code>server = function(input, output, sesssion){
  
  XX &lt;- reactiveVal()  
  
  XX(input$XX, {
    
    XX &lt;- XX(XX)
    
    if(XX == &quot;csv&quot;){
      XX(XX(XX))
    } else if(XX == &quot;RDS&quot;) {
      XX(XX(XX))
    }
  })
  
  XX(XX, {
    
    XX
    
  })
  
  output$XX &lt;- XX(XX, XX)
}</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Lasse die App laufen. Lese Daten ein und teste verschiedene
Code-Inputs. Bei der Entwicklung des Codes ist es wichtig, die Daten
über den <code>reactiveVal</code> anzusprechen. Zum Beispiel, um den
Datensatz in <code>puppies.csv</code> auf die erste Zeile zu reduzieren
könnte man schreiben <code>daten() %&gt;% slice(1)</code>.</li>
</ol>
</div>
<div id="c---dataviewer-3.0" class="section level3">
<h3>C - DataViewer 3.0</h3>
<ol style="list-style-type: decimal">
<li>Entwickeln wir die letzte Version des DataViewer, in dem wir eine
Download einbauen. Setze dafür in die UI zwei
<code>downloadButton</code> mit IDs <code>csv_download</code> und
<code>rds_download</code> und Labels <code>.CSV</code> und
<code>.RDS</code>. Ergänze zudem in beiden Buttons
<code>style='width:49.5%'</code>, damit die Buttons zusammen die volle
Breite ausnutzen. Zuletzt zwei <code>br()</code> und
<code>h5("Download", style="font-weight:700")</code> zwischen die
Download-Buttons und den <code>code_run</code> Action-Button
darüber.</li>
</ol>
<pre class="r"><code>ui &lt;- fluidPage(
  titlePanel(&quot;DataViewer&quot;),
  XX(
    XX(
      XX(XX, 
         XX = XX, 
         XX = XX,
         XX = XX),
      XX(XX),
      XX(XX),
      XX(),
      XX(),
      XX(),
      XX(),
      XX()
    ),
    XX(
      XX(XX)
    )
  )
)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><p>Teste die UI mit
<code>shinyApp(ui, server = function(input, output, sesssion){})</code>.
Sieht alles in Ordnung aus?</p></li>
<li><p>Im <code>server</code> müssen wir uns nun um die Download-Handler
kümmern, sodass die Download-Buttons auch einen Download auslösen. Der
Code unten hat bereits zwei Templates Downloadhandler, denen aber noch
ein paar Informationen fehlen. Als Output IDs stelle IDs der beiden
<code>downloadButton</code>s bereit und für das erste Argument der
Schreibfunktionen die Daten <code>reactiveValue</code> (Klammern nicht
vergessen).</p></li>
</ol>
<pre class="r"><code>server = function(input, output, sesssion){
  
  XX &lt;- reactiveVal()  
  
  XX(input$XX, {
    
    XX &lt;- XX(XX)
    
    if(XX == &quot;csv&quot;){
      XX(XX(XX))
    } else if(XX == &quot;RDS&quot;) {
      XX(XX(XX))
    }
  })
  
  XX(XX, {
    
    XX
    
  })
  
  output$XX &lt;- XX(XX, XX)
  
  
  output$XX &lt;- XX(
    filename = function() {paste(&quot;daten.csv&quot;)},
    content = function(file) {write_csv(XX, file)}
    )
 
  output$XX &lt;- XX(
    filename = function() {paste(&quot;daten.RDS&quot;)},
    content = function(file) {saveRDS(XX, file)}
    )
  
}</code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Teste die App. Lese Daten ein und lade sie herunter. Versuche auch
zwischendrin Code anzuwenden, der die angezeigten Daten verändert. Dies
sollte auch die Daten beeinflussen, die heruntergeladen werden.</li>
</ol>
</div>
</div>
<div id="app" class="section level2">
<h2>App</h2>
<ol style="list-style-type: decimal">
<li>Der nächste Schritt in der Entwicklung unserer App ist es das
Einlesen und Speichern der Daten zu ermöglichen. Kümmern wir uns zuerst
um das Hochladen von Daten und fokussieren zunächst auf die UI. Ergänze
ein <code>fileInput</code> im Upload Panels innerhalb des Daten NavBar
Panels. Als <code>inputId</code>, <code>label</code>, und
<code>buttonLabel</code> weise <code>"hochladen"</code>,
<code>"Wähle eine Datei aus"</code>, und <code>"Auswählen"</code> zu.
Lasse die App einmal laufen und überprüfe ob der File upload zu sehen
ist.</li>
</ol>
<pre class="r"><code>  tabPanel(
    title = &quot;Upload&quot;,
    h2(&quot;Daten hochladen&quot;),
    XX(XX, XX, XX)
    )</code></pre>
<ol start="2" style="list-style-type: decimal">
<li>Im nächsten Schritt, verbessern wir ein klein bisschen die
Usability. Erstens ergänzen wir eine Unterüberschrift, die uns warnt,
dass wir unsere aktuellen Daten überschrieben, wenn wir neue Daten
einlesen. Hierfür ergänze
<code>h4("Achtung Daten werden überschrieben")</code> direkt unterhalb
der Überschrift zweiter Ordnung. Zweitens, füge eine mit
<code>br()</code> eine leere Zeile zwischen der Unterüberschrift und dem
<code>fileInput</code> ein.</li>
</ol>
<pre class="r"><code>  tabPanel(
    title = &quot;Upload&quot;,
    h2(&quot;Daten hochladen&quot;),
    XX,
    XX,
    XX(XX, XX, XX)
    )</code></pre>
<ol start="3" style="list-style-type: decimal">
<li>Die UI des Uploads ist fertig. Jetzt gilt es den <code>server</code>
entsprechend anzupassen. Als erstes muss sichergestellt werden, dass die
Daten nicht wie bisher ausserhalb des <code>sever</code>s gelesen werden
sonder innerhalb. Zudem müssden die Daten genau wie das Objekt
<code>daten</code> reaktiv werden, sodass sie sich ändern können sobald
neue Daten hochgeladen werden. Es gibt verschiedene Wege, wie dies
implementiert werden könnte. Machen wir es mit einem
<code>reactiveVal</code>. Ziehe dafür
<code>verletzungen &lt;- readRDS(daten/verletzungen.RDS)</code> in den
<code>sever</code> und setze eine <code>reactiveVal</code> um die
Lesefunktion, so dass <code>verletzungen</code> reaktiver Wert ist, der
als Default den gesamenten Datensatz beinhaltet.</li>
</ol>
<pre class="r"><code>verletzungen &lt;- reactiveVal(XX)</code></pre>
<ol start="4" style="list-style-type: decimal">
<li><p>Weil <code>verletzungen</code> jetzt ein reaktiver Wert ist, muss
einer Stelle im <code>server</code> eine kleine Ändeurngen vorgenommen
werden. Anonstent treten Probleme auf. Ahnst du schon wo? An einer
Stelle im <code>server</code> wird <code>verletzungen</code> als
normales Datenobjekt werden anstatt als eine reaktiver Wert, das heisst
ohne Klammer anstatt mit. Ergänze die fehlenden Klammern und lasse die
App einmal laufen. Wenn kein Fehler aufkommt, dann hast du alles richtig
gemacht.</p></li>
<li><p>Da nun <code>verletzungen</code> ein reaktiver Wert ist, können
wir Code schreiben der dazu führt, dass <code>verletzungen</code> sich
ändert sobald eine neue Datei bereitgestellt wird. Hierzu eignet sich
<code>observeEvent</code> Block. Ergänze einen solchen, der dann seinen
Code laufen lässt wenn der Upload input (<code>input$hochladen</code>)
sich ändert und innerhalb des Cdes <code>verletzungen</code> durch
Einlesen der neuen Daten verändert. Verwende dafür
<code>input$hochladen$datapath</code>.</p></li>
</ol>
<pre class="r"><code>observeEvent(XX,{
  
  XX(readRDS(XX))
  
})</code></pre>
<ol start="6" style="list-style-type: decimal">
<li><p>Teste nun die App. Wenn du alles richtig eingestellt hast,
solltest du in der Lage sein alternative Daten einzulesen. Probiere
einmal den kleineren Datensatz <code>verletzungen_jahresende.RDS</code>.
Zuerst solltest du sehen, dass der Upload dir “Upload complete”
rückmeldet. Dann solltest im Nachbartab Daten sehen, dass die Tabelle
nur noch etwas mehr als viertausend Zeilen anstatt vorher mehreren
hundertausend. Nichtsdesto sollte aber alles wie zuvor reibungslos
funktionieren. Es sollte sogar möglich sein vor dem Upload Körperteile
und Alter einzustellen und dass diese Einstellungen nach Upload immer
noch aktiv sind und unmittelbar auf den neuen Datensatz angewendet
werden.</p></li>
<li><p>Der Uploadteil ist fertig. Kümmern wir uns jetzt um den Download.
Ergänze in der UI unter dem Upload <code>tabPanel</code> einen
<code>downloadButton</code> mit ID <code>"herunterladen"</code> und
Label <code>"Als .csv herunterladen"</code>. Ergänze zudem
<code>style = 'font-size:20px'</code>, um die Schrift etwas grösser zu
machen, und ein <code>br()</code> vor dem <code>downloadButton</code>
für etwas mehr Platz.</p></li>
</ol>
<pre class="r"><code>  tabPanel(
    title = &quot;Upload&quot;,
    h2(&quot;Daten hochladen&quot;),
    XX,
    XX(XX, XX, XX)
    )</code></pre>
<ol start="8" style="list-style-type: decimal">
<li>Im <code>server</code> ergänze nun den <code>downloadHandler</code>
wie unten dargestellt. Siehe, dass wir den Dateinamen</li>
</ol>
<pre class="r"><code>  output$herunterladen &lt;- downloadHandler(
    filename = function() {&quot;verletzungen.csv&quot;},
    content = function(file) {write_tsv(verletzungen(), file)}
  )</code></pre>
<ol start="9" style="list-style-type: decimal">
<li>Teste nun die App. Ist der Upload zu sehen und funktioniert er?
Teste mal was passiert wenn du erst den kleinen Datensatz hochlädst und
dann wieder herunterlädst.</li>
</ol>
</div>
<div id="lösung" class="section level2">
<h2>Lösung</h2>
<pre class="r"><code>library(shiny)
library(tidyverse)
library(shinyWidgets)

ui = navbarPage(
  &quot;InjuryViewer&quot;,
  
  tabPanel(
    &quot;Dashboard&quot;,
    fluid = TRUE,
    icon = icon(&quot;chart-bar&quot;),
    
    sidebarLayout(
      sidebarPanel(
        width = 3,
        selectInput(&quot;körperteil&quot;, &quot;Körperteil&quot;, 
                    choices = unique(verletzungen$körperteil), 
                    multiple = TRUE),
        sliderInput(&quot;alter&quot;, &quot;Alter&quot;, min = 0, max = 110, value = c(0, 110)),
        actionButton(&quot;diagnose_var&quot;, &quot;Diagnosen&quot;),
        actionButton(&quot;unfallort_var&quot;, &quot;Unfallorte&quot;),
        actionButton(&quot;gegenstand_var&quot;, &quot;Gegenstände&quot;),
      ),
      mainPanel(
        plotOutput(&quot;linien_plot&quot;),
        plotOutput(&quot;lollipop_plot&quot;)
      ),
    )
  ),
  
  tabPanel(
    &quot;Daten&quot;,
    fluid = TRUE,
    icon = icon(&quot;clipboard&quot;),
    tabsetPanel(
      tabPanel(
        title = &quot;Daten&quot;,
        h2(&quot;Aktuelle daten&quot;),
        dataTableOutput(&quot;daten&quot;)
        ),
      tabPanel(
        title = &quot;Upload&quot;,
        h2(&quot;Daten hochladen&quot;),
        h4(&quot;Achtung Daten werden überschrieben&quot;),
        br(),
        fileInput(
          inputId = &quot;hochladen&quot;,
          label = &quot;Wähle eine Datei aus&quot;,
          buttonLabel = &quot;Auswählen&quot;
        )
      ),
      tabPanel(
        title = &quot;Download&quot;,
        h2(&quot;Daten runterladen&quot;),
        br(),
        downloadButton(&quot;herunterladen&quot;,
                       &quot;Als .csv herunterladen&quot;,
                       style = &quot;font-size:20px&quot;)
      )
    )
  ),
  navbarMenu(
    &quot;Informationen&quot;,
    icon = icon(&quot;info-circle&quot;),
    tabPanel(&quot;Datensatz&quot;,
             fluidPage(fluidRow(
               column(
                 6,
                 HTML(&quot;&lt;h2&gt;National Electronic Injury Surveillance System (NEISS)&lt;/h2&gt;
                      &lt;h4&gt;Das National Electronic Injury Surveillance System (NEISS) Datenbank wird seit über 45 Jahren von der Consumer Product Safety Commission (CPSC) betrieben. Ihr Zweck ist die Sammlung von verletzungen, die im Zusammenhang von Konsumprodukten entstehen. Das CPSC nutzt die Daten um eine landesweite in Schätzung von produktabhängigen Verletzungen zu liefern.&lt;br&gt;&lt;br&gt;
                      NEISS basiert auf einer landesweit repräsentativen Stichprobe an Krankenhäusern in den Vereinigten Staaten und seinen Territorien. Jedes teilnehmende Krankenhaus berichtet Patienteninformationen für jeden Besuch einer Notfallabteilung. Mit den NEISS-Daten können landesweite Schätzungen von Besuchen in Notfallabteilungen von Krankenhäusern ermittelt werden.&lt;br&gt;&lt;br&gt;
                      Der aktuelle Datensatz ist ein Ausschnitt der NEISS-Daten. Die Daten wurden auf das Jahr 2017 begrenzt.&lt;br&gt;&lt;br&gt;
                      Mehr Informationen zu NEISS unter &lt;a&gt;https://www.cpsc.gov/Research--Statistics/NEISS-Injury-Data&lt;/a&gt;&lt;/h4&gt;&quot;
                   )
               )
             ))),
    tabPanel(&quot;About&quot;,
             fluidPage(fluidRow(
               column(6, HTML(&quot;&lt;h2&gt;The R Bootcamp&lt;/h2&gt;
                      &lt;h4&gt;Die App wurde erstellt von The R Bootcamp im Rahmen des Kurses Dashboards mit Shiny&lt;br&gt;&lt;br&gt;
                      Mehr Informationen zu The R Bootcamp unter &lt;a&gt;https://therbootcamp.github.io/&lt;/a&gt;&lt;/h4&gt;&quot;
                 ))
             ))),
  )
)

server &lt;- function(input, output, session) {
  
  verletzungen = reactiveVal(readRDS(&quot;daten/verletzungen.RDS&quot;))
  
  daten = reactive({
  verletzungen() %&gt;%
    filter(körperteil %in% input$körperteil,
           alter &gt;= input$alter[1],
           alter &lt;= input$alter[2])
  })
  
  output$daten = renderDataTable(verletzungen(),
                               options = list(pageLength = 10))
  
  output$linien_plot = renderPlot({
  
  daten() %&gt;% 
    count(alter, geschlecht, wt = anzahl) %&gt;%
    ggplot(aes(x = alter, y = n, col = geschlecht)) +
    geom_line(linewidth = 1.5) +
    theme_minimal() +
    theme(
      axis.text = element_text(size = 12),
      axis.title = element_text(size = 16),
      legend.text = element_text(size = 12),
      legend.title = element_text(size = 16),
      plot.margin = margin(.5, .5, 1, 1, unit = &quot;cm&quot;),
      legend.position = &quot;top&quot;
    ) +
    scale_color_viridis_d(name = &quot;Geschlecht&quot;,
                          option = &quot;G&quot;,
                          end = .8) +
    labs(x = &quot;Alter&quot;,
         y = &quot;Geschätzte Anzahl Verletzungen&quot;)
          })
  
  lollipop_var = reactiveVal(&quot;diagnose&quot;)
  
  observeEvent(input$diagnose_var, {
    lollipop_var(&quot;diagnose&quot;)
  })
  observeEvent(input$unfallort_var, {
    lollipop_var(&quot;unfallort&quot;)
  })
  observeEvent(input$gegenstand_var, {
    lollipop_var(&quot;gegenstand&quot;)
  })
  
  output$lollipop_plot = renderPlot({
  
    daten() %&gt;%
      mutate(variable = .data[[lollipop_var()]]) %&gt;%
      count(variable, geschlecht, wt = anzahl) %&gt;%
      ggplot(aes(x = variable, y = n, col = geschlecht)) +
      geom_pointrange(
        aes(ymin = 0, ymax = n),
        linewidth = 1.2,
        size = 1.2,
        position = position_dodge(width = .5)
      ) +
      scale_color_viridis_d(option = &quot;G&quot;, end = .8) +
      theme_minimal() +
      theme(
        axis.title.y = element_text(size = 16),
        axis.title.x = element_blank(),
        axis.text.y = element_text(size = 12),
        axis.text.x = element_text(
          size = 16,
          angle = 45,
          hjust = 1
        ),
        plot.margin = margin(.5, .5, .5, 1, unit = &quot;cm&quot;),
        legend.position = &quot;none&quot;
      ) +
      labs(y = &quot;Geschätzte Anzahl&quot;)
    })
  
  
    observeEvent(input$hochladen, {
      verletzungen(readRDS(input$hochladen$datapath))
      })
  
    output$herunterladen &lt;- downloadHandler(
      filename = function() {&quot;verletzungen.csv&quot;},
      content = function(file) {write_tsv(verletzungen(), file)}
    )

    
  }
  
  shinyApp(ui, server)</code></pre>
</div>
<div id="datensatz" class="section level2">
<h2>Datensatz</h2>
<p>Der Datensatz stammt von dem National Electronic Injury Surveillance
System (NEISS) in den USA, das seit vielen Jahren Unfälle aus einem
repräsentativen Stichprobe von Krankenhäusern sammelt. Der Datensatz
wurde ins Deutsche übersetzt und angepasst.<br />
Es liegen zwei Ausschnitte des Datensatzes vor.
<code>verletzungen.RDS</code> beinhaltet alle 251’545 Fälle des Jahres
2017, <code>verletzungen_jahresende.RDS</code> dagegen nur die 4’181
Fälle zwischen Heiligabend und Silvester.</p>
<p>Die beiden Datensätze beinhalten die folgenden Variablen:</p>
<table>
<thead>
<tr class="header">
<th>Name</th>
<th align="left">Beschreibung</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>datum</td>
<td align="left">Datum des Unfalls / der Verletzung</td>
</tr>
<tr class="even">
<td>alter</td>
<td align="left">Alter der Person</td>
</tr>
<tr class="odd">
<td>geschlecht</td>
<td align="left">Geschlecht der Person</td>
</tr>
<tr class="even">
<td>körperteil</td>
<td align="left">Körperteil, das verletzt wurde</td>
</tr>
<tr class="odd">
<td>diagnose</td>
<td align="left">Diagnose der Verletzung</td>
</tr>
<tr class="even">
<td>unfallort</td>
<td align="left">Unfallort der Verletzung</td>
</tr>
<tr class="odd">
<td>gegenstand</td>
<td align="left">Gegenstand, der die Verletzung herbeigeführt hat</td>
</tr>
<tr class="even">
<td>anzahl</td>
<td align="left">Anzahl an Verletzungen</td>
</tr>
</tbody>
</table>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
